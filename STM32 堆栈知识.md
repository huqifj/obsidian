# STM32 堆栈知识


堆和栈都是 RAM 上的物理空间，一般在启动文件或链接脚本文件中指定，最后在 C 库的 __main 函数中初始化。

![20190701140057743.jpg](20190701140057743.jpg)

堆和栈在编译后被包含到 ZI-Data 中。

在使用 RTOS 时，每个任务拥有独立的栈空间。栈空间可以是预先分配好的全局数组，也可以是动态分配的一段内存空间。

可以将 HEAP_BEGIN 至 HEAP_END 之间的内存空间交由 RT-Thread 管理。

ZI\$\$Limit 是一个链接器导出的符号，代表 ZI-Data 段的结束，也即程序执行时所占 RAM 空间的结束地址，也是未使用 RAM 空间的起始地址。因此 RT-Thread Master 版本中会默认将 RAM 中剩余的内存空间全部交给 RT-Thread 进行动态内存管理。

分散加载简单的讲就是手动控制程序各部分的存放地址，并且在后续调用时，手动链接这些地址并告知编译器下一步的执行地址，这其中有一个应用是远程 IOT 升级，只升级程序中某一个部分用于升级功能和修复 bug，可以做到节约能耗和流量的效果，还有一个很重要的应用是程序加速（可以加速 20%-50%），即将需要加速运行的程序部分放到 SRAM 中去运行而不是 flash 中，这是因为有时候 flash 的读写速度会跟不上内核 CPU 的运行速度，导致拖慢总体程序执行速度，串口数据传输达不到标准的最高速的原因之一就是这点。


![image-20220919151044.png](image-20220919151044.png)
